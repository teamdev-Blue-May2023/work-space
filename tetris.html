<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>テトリス</title>
  <style>
    body {
      background: #ddf5ff;
    }

    #container {
      margin: 0 auto;
    }
  </style>
</head>

<body onload="init()">
  <div id="container">
    <canvas id="cvs"></canvas>
  </div>
  <script>
    //ブロック1マスの大きさ
    const blockSize = 30;
    //ボードサイズ
    const boardRow = 20;
    const boardCol = 10;
    //キャンバスの取得
    const cvs = document.getElementById("cvs");
    //2dコンテキストを取得
    const ctx = cvs.getContext("2d");
    //キャンバスサイズ
    const canvasW = blockSize * boardCol;
    const canvasH = blockSize * boardRow;
    cvs.width = canvasW;
    cvs.height = canvasH;
    //コンテナの設定
    const container = document.getElementById("container");
    container.style.width = canvasW + 'px';

    // tetの1辺の長さ
    const tetSize = 4;

    //テトリミノの追加
    const tetTypes = [
      [], //配列のインデックス0は空としておく。
      [
        [0, 0, 0, 1],
        [0, 0, 1, 0],
        [0, 1, 0, 0],
        [1, 0, 0, 0],
      ],
      [
        [0, 0, 0, 0],
        [0, 0, 1, 1],
        [0, 0, 1, 1],
        [0, 0, 0, 0],
      ],
      [
        [0, 0, 0, 0],
        [0, 0, 1, 0],
        [0, 1, 1, 1],
        [0, 0, 0, 0],
      ],
      [
        [0, 0, 0, 0],
        [0, 1, 1, 0],
        [0, 0, 1, 1],
        [0, 0, 0, 0],
      ],
      [
        [0, 0, 0, 0],
        [0, 0, 1, 1],
        [0, 1, 1, 0],
        [0, 0, 0, 0],
      ],
      [
        [0, 0, 0, 0],
        [1, 1, 1, 1],
        [0, 0, 0, 0],
        [0, 0, 0, 0],
      ],
      [
        [0, 0, 0, 0],
        [0, 1, 1, 1],
        [0, 0, 0, 1],
        [0, 0, 0, 0],
      ],
      [
        [0, 0, 0, 0],
        [0, 0, 0, 1],
        [0, 1, 1, 1],
        [0, 0, 0, 0],
      ],
    ];

    //テトリミノの配列に対する色設定
    const tetColors = [
        '', // 0は空のため色もなし
        '#faebd7',
        '#6495ed',
        '#00ff7f',
        '#cd853f',
        '#ff00ff',
        '#4b0082',
        '#f0f8ff',
        '#808000',
      ];

    let tet_idx = 4;
    let tet = tetTypes[tet_idx];

    //ボード本体
    const board = [];

    //描画処理
    const draw = () => {
      //塗りに黒を設定
      ctx.fillStyle = '#000';
      //キャンバスを塗りつぶす
      ctx.fillRect(0, 0, canvasW, canvasH);

      //ボードに存在しているブロックを塗る
      for (let y = 0; y < boardRow; y++) {
        for (let x = 0; x < boardCol; x++) {
          if (board[y][x]) {
            drawBlock(x, y, board[y][x]);
          }
        }
      }

      // 「移動」「回転」の動作確認のためにテトリミノのサンプルを一つ描画する
      for (let y = 0; y < tetSize; y++) {
        for (let x = 0; x < tetSize; x++) {
          if (tet[y][x]) {
            drawBlock(x, y, tet_idx);
          }
        }
      }
    }

    //回転
    const createRotateTet = () => {
      //新しいtetを作る
      let newTet = [];
      for (let y = 0; y < tetSize; y++) {
        newTet[y] = [];
        for (let x = 0; x < tetSize; x++) {
          //時計回りに90度回転させる
          newTet[y][x] = tet[tetSize - 1 - x][y];
        }
      }
      return newTet;
    };

    document.onkeydown = (e) => {
      switch (e.keyCode) {
        case 32: //space
          let newTet = createRotateTet();
          tet = newTet;
      }
      draw();
    };

    // ブロックの描画
    const drawBlock = (x, y, tet_idx) => {
      let px = x * blockSize;
      let py = y * blockSize;
      //塗りを設定
      ctx.fillStyle = tetColors[tet_idx];
      ctx.fillRect(px, py, blockSize, blockSize);
      //線を設定
      ctx.strokeStyle = 'black';
      //線を描画
      ctx.strokeRect(px, py, blockSize, blockSize);
    };

    //初期化処理
    const init = () => {
      //ボード(20*10を0埋め)
      for (let y = 0; y < boardRow; y++) {
        board[y] = [];
        for (let x = 0; x < boardCol; x++) {
          board[y][x] = 0;
        }
      }

      draw();
    };
  </script>
</body>

</html>